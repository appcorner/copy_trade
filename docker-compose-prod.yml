version: '3.8'

services:
  # ----------------------------
  # 1. Database Service (Postgres)
  # ----------------------------
  db:
    image: postgres:15-alpine
    container_name: copy_trade_db
    restart: always
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: mysecretpassword  # üëà ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
      POSTGRES_DB: copy_trade_prod
    volumes:
      - pg_data:/var/lib/postgresql/data
    ports:
      - "5432:5432" # ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ß‡πâ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏≤ pgAdmin ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡∏î‡∏π (‡∏õ‡∏¥‡∏î‡πÑ‡∏î‡πâ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢)

  # ----------------------------
  # 2. App Service (Elixir)
  # ----------------------------
  app:
    build: .
    container_name: copy_trade_app
    restart: always
    depends_on:
      - db
    ports:
      - "4000:4000" # Web Access
      - "5001:5001" # TCP Socket for EA
    environment:
      MIX_ENV: prod
      PHX_SERVER: "true"
      SECRET_KEY_BASE: "REPLACE_WITH_YOUR_SECRET_KEY_BASE" # üëà ‡πÄ‡∏≠‡∏≤‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å mix phx.gen.secret ‡∏°‡∏≤‡πÉ‡∏™‡πà
      DATABASE_URL: "ectou://postgres:mysecretpassword@db/copy_trade_prod" # üëà ‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï @db ‡∏Ñ‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠ service ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô
    volumes:
      - ./uploads:/app/uploads # ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå

volumes:
  pg_data: